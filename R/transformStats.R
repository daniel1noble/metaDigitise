#' @title error_to_sd
#' @description Transforms error to standard deviation
#' @param error some form of error
#' @param n Sample Size
#' @param error_type type of error measured
#' @return Returns vector of standard errors
#' @author Joel Pick
#' @export

error_to_sd <- function(error, n, error_type=c("se","CI95","sd")){
	if(error_type=="se") sd <- se_to_sd(error, n)
	if(error_type=="CI95") sd <- CI95_to_sd(error, n)
	if(error_type=="sd") sd <- error
	return(sd)
}


#' @title se_to_sd
#' @description Transforms standard error to standard deviation
#' @param se Standard Error of the mean
#' @param n Sample Size
#' @return Returns vector of standard errors
#' @author Joel Pick
#' @export

se_to_sd <- function(se, n) {
	se * sqrt(n)
}


#' @title CI95_to_sd
#' @description Transforms standard error to standard deviation
#' @param CI Interval difference from the mean
#' @param n Sample Size
#' @return Returns vector of standard deviations
#' @author Joel Pick
#' @export

CI95_to_sd <- function(CI,n) {
	CI/1.96 * sqrt(n)
}

# #' @title range_to_sd
# #' @description Transforms range to standard deviation
# #' @param CI Interval difference from the mean
# #' @param n Sample Size
# #' @return Returns vector of standard deviations
# #' @author Joel Pick
# #' @export

# range_to_sd <- function(min,max,n) {
# 	CI/1.96 * sqrt(n)
# }


#' @title rqm_to_mean
#' @description Calculate the mean from the box plots
#' @param min Minimum value
#' @param LQ Lower 75th quartile
#' @param median Median
#' @param UQ Upper 75th quartile
#' @param max Maximum value
#' @return Returns vector of mean
#' @author Joel Pick
#' @export
rqm_to_mean <- function(min,LQ,median,UQ,max){
	b <- max
	a <- min
	q3 <- UQ
	q1 <- LQ
	m <- median
	
	##from Wan et al. 2014; equation 10
	Xbar <- (a + 2*q1 + 2*m + 2*q3 + b)/8
	return(Xbar)
}

#' @title rqm_to_sd
#' @description Calculate the standard deviation from box plots
#' @param min Minimum value
#' @param LQ Lower 75th quartile
#' @param UQ Upper 75th quartile
#' @param max Maximum value
#' @param n Sample size
#' @return Returns vector of standard deviation
#' @author Joel Pick
#' @export
rqm_to_sd <- function(min,LQ,UQ,max,n) {
	b <- max
	a <- min
	q3 <- UQ
	q1 <- LQ
	
	##from Wan et al. 2014; equation 13
	S <- (b-a) / ( 4*qnorm( (n-0.375)/(n+0.25) ) ) + 
		(q3-q1) / ( 4*qnorm( (0.75*n-0.125)/(n+0.25) ) )
		
	return(S)
}

#' @title range_to_sd
#' @description Converts a range to a standard deviation
#' @param min Minimum value
#' @param max Maximum value
#' @param n Sample size
#' @return Returns vector of standard deviation
#' @author Joel Pick
#' @export

range_to_sd <- function(min,max,n) {
	a <- min
	b <- max
	
	##from Wan et al. 2014; equation 9
	S <- (b-a) / ( 2*qnorm( (n-0.375)/(n+0.25) ) ) 

	return(S)
}

#' @title grandMean
#' @description Pooled mean of a set of group means
#' @param mean Mean
#' @param n Sample size
#' @return Returns vector of pooled mean
#' @author Joel Pick
#' @export

grandMean <- function(mean,n)	sum(mean*n)/sum(n)


#' @title grandSD
#' @description Pooled standard deviation of a set of groups
#' @param mean Mean
#' @param sd standard deviation
#' @param n Sample size
#' @param equal Logical: Whether to calculate pooled SD assuming groups have the same means (TRUE) or different means (FALSE) 
#' @return Returns vector of pooled mean
#' @author Joel Pick
#' @export
## for non-overlapping SDs
## https://en.wikipedia.org/w/index.php?title=Standard_deviation&oldid=724302220#Combining_standard_deviations

grandSD <- function(mean,sd,n, equal = FALSE){
	if(equal == FALSE){
	sqrt(
		( sum( (n-1)*sd^2 + n*mean^2 ) - sum(n)*(sum(mean*n)/sum(n))^2 )
		/
		(sum(n) -1)
		)
	}else{
	sqrt( sum( (n-1)*sd^2 ) / sum(n -1) )
	}
}